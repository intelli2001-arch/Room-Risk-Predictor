<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ìŠµì‹¤ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ ì˜ˆì¸¡ (2026)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 16px;
            color: #1f1f1f;
        }
        
        h2 {
            font-size: 1.25rem;
            margin-bottom: 12px;
            color: #1f1f1f;
        }
        
        .intro {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .intro p {
            margin-bottom: 8px;
        }
        
        .ml-badge {
            display: inline-block;
            background: linear-gradient(135deg, #7B68EE, #9370DB);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 8px;
        }
        
        .risk-legend {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .risk-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .risk-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .risk-danger { background: #FF4B4B; }
        .risk-imminent { background: #FFA500; }
        .risk-caution { background: #FFD700; }
        .risk-safe { background: #00CC66; }
        
        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 20px 0;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #FF4B4B;
            color: white;
        }
        
        .btn-primary:hover {
            background: #e04343;
        }
        
        .btn-secondary {
            background: #f0f2f6;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e0e2e6;
        }
        
        .btn-book {
            background: #0066FF;
            color: white;
            padding: 14px 32px;
            font-size: 1.1rem;
        }
        
        .btn-book:hover {
            background: #0052cc;
        }
        
        .btn-book:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .alert-info {
            background: #e7f3ff;
            border-left: 4px solid #0066FF;
            color: #0052cc;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .main-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .main-tab {
            padding: 12px 24px;
            background: #f0f2f6;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .main-tab:hover {
            background: #e8eaf0;
        }
        
        .main-tab.active {
            background: white;
            border-bottom: 3px solid #FF4B4B;
            color: #FF4B4B;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .biz-subtabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .biz-subtab {
            padding: 10px 20px;
            background: #f0f2f6;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .biz-subtab.active {
            background: #FF4B4B;
            color: white;
            border-color: #FF4B4B;
        }
        
        .analysis-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .promo-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .promo-slot {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #ddd;
            background: #f5f5f5;
        }
        
        .promo-slot.open-practice {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        
        .promo-slot.time-sale {
            background: #fff3e0;
            border-color: #FF9800;
        }
        
        .promo-select {
            width: 100%;
            padding: 4px;
            margin-top: 6px;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .promo-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .promo-summary-card {
            padding: 15px;
            border-radius: 10px;
        }
        
        .promo-summary-card.open-practice {
            background: #e3f2fd;
        }
        
        .promo-summary-card.time-sale {
            background: #fff3e0;
        }
        
        .alert-exam {
            background: #fff0f0;
            border-left: 4px solid #FF4B4B;
            color: #cc0000;
        }
        
        .alert-perf {
            background: #f0f0ff;
            border-left: 4px solid #7B68EE;
            color: #5a4fcf;
        }
        
        .date-picker {
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .date-info {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .date-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .date-info-row:last-child {
            border-bottom: none;
        }
        
        .period-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-right: 8px;
        }
        
        .badge-holiday {
            background: #ffe0e0;
            color: #cc0000;
        }
        
        .badge-exam {
            background: #fff0e0;
            color: #cc6600;
        }
        
        .badge-perf {
            background: #e0e0ff;
            color: #6600cc;
        }
        
        .badge-normal {
            background: #e0f0e0;
            color: #006600;
        }
        
        #chart {
            width: 100%;
            height: 400px;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 16px;
        }
        
        .time-slot {
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .time-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .time-slot.selected {
            border: 2px solid #0066FF;
        }
        
        .time-slot-time {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .time-slot-risk {
            font-size: 0.85rem;
        }
        
        .slot-danger {
            background: linear-gradient(135deg, #FF4B4B 0%, #ff6b6b 100%);
            color: white;
        }
        
        .slot-imminent {
            background: linear-gradient(135deg, #FFA500 0%, #ffb733 100%);
            color: white;
        }
        
        .slot-caution {
            background: linear-gradient(135deg, #FFD700 0%, #ffe033 100%);
            color: #333;
        }
        
        .slot-safe {
            background: linear-gradient(135deg, #00CC66 0%, #33d685 100%);
            color: white;
        }
        
        .slot-disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .slot-disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .booking-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .booking-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .booking-row:last-child {
            border-bottom: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .modal-content h2 {
            margin-bottom: 20px;
        }
        
        .modal-content p {
            margin-bottom: 20px;
            color: #666;
        }
        
        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }
        
        .expandable {
            cursor: pointer;
        }
        
        .expandable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-top: 16px;
        }
        
        .expandable-header:hover {
            background: #e9ecef;
        }
        
        .expand-icon {
            transition: transform 0.2s;
        }
        
        .expanded .expand-icon {
            transform: rotate(180deg);
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ ì—°ìŠµì‹¤ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ ì˜ˆì¸¡ (2026) <span class="ml-badge">ML ê¸°ë°˜</span></h1>
        
        <div class="main-tabs">
            <button class="main-tab active" onclick="switchMainTab('customer')">ğŸ‘¤ ê³ ê°</button>
            <button class="main-tab" onclick="switchMainTab('business')">ğŸ¢ ì‚¬ì—…ì</button>
        </div>
        
        <!-- ê³ ê° íƒ­ -->
        <div id="customerTab" class="tab-content active">
        
        <div class="intro">
            <p>ì´ ì„œë¹„ìŠ¤ëŠ” <strong>ë¨¸ì‹ ëŸ¬ë‹(RandomForest) ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ ì˜ˆì•½ ë§ˆê° í™•ë¥ </strong>ì„ ì œê³µí•˜ì—¬ ì‚¬ìš©ìê°€ ë” í•©ë¦¬ì ìœ¼ë¡œ ì˜ˆì•½ ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.</p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 12px;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 8px; text-align: center;">ë‹¨ê³„</th>
                        <th style="padding: 8px; text-align: center;">ìœ„í—˜ë„</th>
                        <th style="padding: 8px; text-align: center;">ë§ˆê° í™•ë¥ </th>
                        <th style="padding: 8px; text-align: left;">ì˜ë¯¸</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸŸ¢</td>
                        <td style="padding: 8px; text-align: center;"><strong>ì—¬ìœ </strong></td>
                        <td style="padding: 8px; text-align: center;">0~25%</td>
                        <td style="padding: 8px;">ì§€ê¸ˆ ì˜ˆì•½í•˜ì§€ ì•Šì•„ë„ ì¶©ë¶„íˆ ì—¬ìœ  ìˆìŒ</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸŸ¡</td>
                        <td style="padding: 8px; text-align: center;"><strong>ì£¼ì˜</strong></td>
                        <td style="padding: 8px; text-align: center;">25~50%</td>
                        <td style="padding: 8px;">ì¡°ê¸ˆì”© ì°° ê°€ëŠ¥ì„± ìˆìŒ</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸŸ </td>
                        <td style="padding: 8px; text-align: center;"><strong>ì„ë°•</strong></td>
                        <td style="padding: 8px; text-align: center;">50~75%</td>
                        <td style="padding: 8px;">ì˜ˆì•½ ì§€ì—° ì‹œ í™•ë³´ ì–´ë ¤ì›€</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸ”´</td>
                        <td style="padding: 8px; text-align: center;"><strong>ìœ„í—˜</strong></td>
                        <td style="padding: 8px; text-align: center;">75~100%</td>
                        <td style="padding: 8px;">ë¹ ë¥¸ ì˜ˆì•½ í•„ìš”</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="divider"></div>
        
        <div class="section">
            <h2>1. ML ëª¨ë¸ ì¤€ë¹„</h2>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="initializeModel()">ğŸ“Š ML ëª¨ë¸ í•™ìŠµ</button>
            </div>
            <div id="dataStatus" class="alert alert-warning">
                âš ï¸ 'ML ëª¨ë¸ í•™ìŠµ' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
            </div>
            
            <div id="dataPreviewSection" class="hidden">
                <div class="expandable" onclick="toggleDataPreview()">
                    <div class="expandable-header">
                        <span>ğŸ“‹ í•™ìŠµ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (ì²˜ìŒ 20ê°œ í–‰)</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                </div>
                <div id="dataPreview" class="data-preview hidden"></div>
            </div>
        </div>
        
        <div class="section" id="dateSection">
            <h2>2. 2026ë…„ ë‚ ì§œ ì„ íƒ</h2>
            <div id="dateWarning" class="alert alert-warning">
                âš ï¸ ë¨¼ì € 'ML ëª¨ë¸ í•™ìŠµ' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
            </div>
            <div id="datePickerSection" class="hidden">
                <label for="datePicker">ì˜ˆì•½ í¬ë§ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
                <br>
                <input type="date" id="datePicker" class="date-picker" onchange="onDateChange()">
                <div id="dateInfo" class="date-info hidden"></div>
                <div id="periodAlerts"></div>
            </div>
        </div>
        
        <div class="section" id="riskSection">
            <h2>3. ì‹œê°„ëŒ€ë³„ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ (ML ì˜ˆì¸¡)</h2>
            <div id="riskWarning" class="alert alert-warning">
                âš ï¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
            </div>
            <div id="chartSection" class="hidden">
                <div id="chart"></div>
                
                <h3 style="margin-top: 24px; margin-bottom: 12px;">ì‹œê°„ëŒ€ ì„ íƒ</h3>
                <p style="color: #666; margin-bottom: 12px;">ì˜ˆì•½í•  ì‹œê°„ëŒ€ë¥¼ í´ë¦­í•˜ì„¸ìš”:</p>
                <div id="timeSlots" class="time-slots"></div>
            </div>
        </div>
        
        <div class="section" id="bookingSection">
            <h2>4. ì˜ˆì•½í•˜ê¸°</h2>
            <div id="bookingWarning" class="alert alert-warning">
                âš ï¸ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
            </div>
            <div id="bookingSummary" class="booking-summary hidden">
                <h3 style="margin-bottom: 16px;">ì˜ˆì•½ ì •ë³´ í™•ì¸ (ML ì˜ˆì¸¡)</h3>
                <div id="bookingDetails"></div>
                <div style="margin-top: 20px; text-align: center;">
                    <button id="bookingBtn" class="btn btn-book" onclick="processBooking()">ğŸ¯ ì˜ˆì•½í•˜ê¸°</button>
                </div>
            </div>
        </div>
        
        </div><!-- End customerTab -->
        
        <!-- ì‚¬ì—…ì íƒ­ -->
        <div id="businessTab" class="tab-content">
            <div class="intro">
                <p><strong>ì‚¬ì—…ììš© ëŒ€ì‹œë³´ë“œ</strong>ì…ë‹ˆë‹¤. ML ë¶„ì„ ê²°ê³¼ë¥¼ í™œìš©í•˜ì—¬ ê³µê°„ ìš´ì˜ì„ ìµœì í™”í•˜ì„¸ìš”.</p>
                <ul style="margin-top: 12px; padding-left: 20px;">
                    <li>ğŸ“Š <strong>ê³µê°„ í™œìš©ë¥  ë¶„ì„</strong>: ì‹œê¸°ë³„, ì‹œê°„ëŒ€ë³„ ìˆ˜ìš” íŒ¨í„´ íŒŒì•…</li>
                    <li>ğŸ·ï¸ <strong>í”„ë¡œëª¨ì…˜ ê´€ë¦¬</strong>: ì €ìˆ˜ìš” ì‹œê°„ëŒ€ë¥¼ ì˜¤í”ˆì—°ìŠµì‹¤ì´ë‚˜ íƒ€ì„ì„¸ì¼ë¡œ ì „í™˜</li>
                </ul>
            </div>
            
            <div class="divider"></div>
            
            <div class="section">
                <h2>ML ëª¨ë¸ ì¤€ë¹„</h2>
                <div id="bizDataStatus" class="alert alert-warning">
                    âš ï¸ 'ML ëª¨ë¸ í•™ìŠµ' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
                </div>
                <div id="bizModelReady" class="alert alert-success hidden">
                    âœ… ML ëª¨ë¸ ì¤€ë¹„ ì™„ë£Œ
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="initializeModel()">ğŸ“Š ML ëª¨ë¸ í•™ìŠµ</button>
                </div>
            </div>
            
            <div id="bizAnalysisSection" class="hidden">
                <div class="biz-subtabs">
                    <button class="biz-subtab active" onclick="switchBizTab('analysis')">ğŸ“Š ê³µê°„ í™œìš©ë¥  ë¶„ì„</button>
                    <button class="biz-subtab" onclick="switchBizTab('promo')">ğŸ·ï¸ í”„ë¡œëª¨ì…˜ ê´€ë¦¬</button>
                </div>
                
                <!-- ê³µê°„ í™œìš©ë¥  ë¶„ì„ -->
                <div id="analysisContent" class="section">
                    <h2>ğŸ“Š ê³µê°„ í™œìš©ë¥  ë¶„ì„</h2>
                    <div style="margin-bottom: 16px;">
                        <label for="analysisType">ë¶„ì„ ìœ í˜• ì„ íƒ:</label>
                        <select id="analysisType" class="date-picker" style="width: auto;" onchange="runAnalysis()">
                            <option value="monthly">ì›”ë³„ í‰ê·  ìˆ˜ìš”</option>
                            <option value="weekday">ìš”ì¼ë³„ í‰ê·  ìˆ˜ìš”</option>
                            <option value="hourly">ì‹œê°„ëŒ€ë³„ í‰ê·  ìˆ˜ìš”</option>
                            <option value="period">ê¸°ê°„ íŠ¹ì„±ë³„ ìˆ˜ìš”</option>
                        </select>
                    </div>
                    <div id="analysisChart"></div>
                    <p style="color: #666; margin-top: 12px;">ğŸ’¡ ìˆ˜ìš”ê°€ ë‚®ì€ ì‹œê°„ëŒ€/ê¸°ê°„ì„ íƒ€ì„ì„¸ì¼ì´ë‚˜ ì˜¤í”ˆì—°ìŠµì‹¤ë¡œ ì „í™˜í•˜ë©´ ìˆ˜ìµì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                
                <!-- í”„ë¡œëª¨ì…˜ ê´€ë¦¬ -->
                <div id="promoContent" class="section hidden">
                    <h2>ğŸ·ï¸ ì €ìˆ˜ìš” ì‹œê°„ëŒ€ í”„ë¡œëª¨ì…˜ ê´€ë¦¬</h2>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 16px;">
                        <div>
                            <label for="promoDate">ë¶„ì„í•  ë‚ ì§œ:</label><br>
                            <input type="date" id="promoDate" class="date-picker" onchange="analyzePromoSlots()">
                        </div>
                        <div>
                            <label for="promoThreshold">ì €ìˆ˜ìš” ê¸°ì¤€ (% ì´í•˜):</label><br>
                            <input type="range" id="promoThreshold" min="10" max="50" value="30" style="width: 150px;" onchange="analyzePromoSlots()">
                            <span id="thresholdValue">30%</span>
                        </div>
                    </div>
                    <div id="promoWarning" class="alert alert-warning">
                        ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
                    </div>
                    <div id="promoSlotsContainer" class="hidden">
                        <div id="promoInfo"></div>
                        <div id="promoSlots" class="promo-slots"></div>
                        <div class="divider"></div>
                        <h3>í”„ë¡œëª¨ì…˜ ìš”ì•½</h3>
                        <div class="promo-summary">
                            <div class="promo-summary-card open-practice">
                                <h4 style="color: #2196F3; margin-bottom: 8px;">ğŸ¸ ì˜¤í”ˆì—°ìŠµì‹¤</h4>
                                <p style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">ëˆ„êµ¬ë‚˜ ììœ ë¡­ê²Œ ì´ìš© ê°€ëŠ¥í•œ ê°œë°© ì‹œê°„</p>
                                <strong id="openPracticeCount">0ê°œ ì‹œê°„ëŒ€</strong>
                                <div id="openPracticeSlots"></div>
                            </div>
                            <div class="promo-summary-card time-sale">
                                <h4 style="color: #FF9800; margin-bottom: 8px;">ğŸ’° íƒ€ì„ì„¸ì¼</h4>
                                <p style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">í• ì¸ëœ ê°€ê²©ìœ¼ë¡œ ì˜ˆì•½ ìœ ë„</p>
                                <strong id="timeSaleCount">0ê°œ ì‹œê°„ëŒ€</strong>
                                <div id="timeSaleSlots"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- End businessTab -->
        
    </div>
    
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ‰ ì˜ˆì•½ ì‹ ì²­ ì™„ë£Œ!</h2>
            <p>ê²°ì œ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br><br><strong>(PoC ë°ëª¨ - ì‹¤ì œ ê²°ì œ ì—°ë™ ì—†ìŒ)</strong></p>
            <div id="modalBookingInfo"></div>
            <button class="btn btn-primary" style="margin-top: 20px;" onclick="closeModal()">í™•ì¸</button>
        </div>
    </div>
    
    <script>
        const WEEKDAY_NAMES = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        const WEEKDAY_NAMES_PY = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
        const TIME_SLOTS = [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22];
        
        const HOLIDAYS_2026 = [
            '2026-01-01', '2026-03-01', '2026-03-02', '2026-05-05',
            '2026-05-24', '2026-06-06', '2026-08-15', '2026-10-03',
            '2026-10-09', '2026-12-25'
        ];
        
        const EXAM_PERIODS_2026 = [
            ['2026-04-13', '2026-04-24'],
            ['2026-06-08', '2026-06-19'],
            ['2026-10-12', '2026-10-23'],
            ['2026-12-07', '2026-12-18']
        ];
        
        const PERFORMANCE_SEASONS_2026 = [
            ['2026-05-11', '2026-06-05'],
            ['2026-11-02', '2026-11-27']
        ];
        
        let trainingData = null;
        let modelWeights = null;
        let selectedDate = null;
        let selectedTimeSlots = [];
        let riskData = {};
        let currentPeriodInfo = {};
        
        function seededRandom(seed) {
            const x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }
        
        function isInPeriod(dateStr, periods) {
            const targetDate = new Date(dateStr);
            for (const [startStr, endStr] of periods) {
                const start = new Date(startStr);
                const end = new Date(endStr);
                if (targetDate >= start && targetDate <= end) {
                    return true;
                }
            }
            return false;
        }
        
        function getPeriodInfo(dateStr) {
            const date = new Date(dateStr);
            const weekday = date.getDay();
            const isWeekend = weekday === 0 || weekday === 6;
            const isHoliday = isWeekend || HOLIDAYS_2026.includes(dateStr);
            const isExam = isInPeriod(dateStr, EXAM_PERIODS_2026);
            const isPerf = isInPeriod(dateStr, PERFORMANCE_SEASONS_2026);
            
            return {
                isHoliday,
                isExam,
                isPerf
            };
        }
        
        function generateTrainingData() {
            const data = [];
            const startDate = new Date(2025, 0, 1);
            const endDate = new Date(2025, 11, 31);
            let seed = 42;
            
            const examPeriods2025 = [
                ['2025-04-14', '2025-04-25'],
                ['2025-06-09', '2025-06-20'],
                ['2025-10-13', '2025-10-24'],
                ['2025-12-08', '2025-12-19']
            ];
            
            const perfSeasons2025 = [
                ['2025-05-12', '2025-06-06'],
                ['2025-11-03', '2025-11-28']
            ];
            
            const holidays2025 = [
                '2025-01-01', '2025-01-28', '2025-01-29', '2025-01-30',
                '2025-03-01', '2025-05-05', '2025-05-06', '2025-06-06',
                '2025-08-15', '2025-10-03', '2025-10-06', '2025-10-07',
                '2025-10-08', '2025-10-09', '2025-12-25'
            ];
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                const weekday = d.getDay();
                const pyWeekday = (weekday + 6) % 7;
                const isWeekend = weekday === 0 || weekday === 6;
                const isHoliday = isWeekend || holidays2025.includes(dateStr) ? 1 : 0;
                const isExam = isInPeriod(dateStr, examPeriods2025) ? 1 : 0;
                const isPerf = isInPeriod(dateStr, perfSeasons2025) ? 1 : 0;
                
                for (const hour of TIME_SLOTS) {
                    let baseProb = 0.25;
                    
                    if (isHoliday) baseProb += 0.20;
                    if (isExam) baseProb -= 0.15;  // ì‹œí—˜ê¸°ê°„ì—ëŠ” ì—°ìŠµ ìˆ˜ìš” ê°ì†Œ
                    if (isPerf) baseProb += 0.30;  // ê³µì—°ì‹œì¦Œì—ëŠ” ì—°ìŠµ ìˆ˜ìš” í¬ê²Œ ì¦ê°€
                    
                    if (hour >= 18 && hour <= 21) baseProb += 0.30;
                    else if (hour >= 14 && hour <= 17) baseProb += 0.15;
                    else if (hour >= 9 && hour <= 11) baseProb += 0.05;
                    
                    const isBooked = seededRandom(seed++) < baseProb ? 1 : 0;
                    
                    data.push({
                        month: d.getMonth() + 1,
                        day: d.getDate(),
                        weekday: pyWeekday,
                        hour: hour,
                        isHoliday: isHoliday,
                        isExam: isExam,
                        isPerf: isPerf,
                        isBooked: isBooked
                    });
                }
            }
            
            return data;
        }
        
        function trainSimulatedModel(data) {
            const weights = {
                baseProb: 0.25,
                holidayEffect: 0,
                examEffect: 0,
                perfEffect: 0,
                eveningEffect: 0,
                afternoonEffect: 0,
                morningEffect: 0
            };
            
            const holidayData = data.filter(d => d.isHoliday === 1);
            const nonHolidayData = data.filter(d => d.isHoliday === 0);
            weights.holidayEffect = (holidayData.reduce((s, d) => s + d.isBooked, 0) / holidayData.length) -
                                   (nonHolidayData.reduce((s, d) => s + d.isBooked, 0) / nonHolidayData.length);
            
            const examData = data.filter(d => d.isExam === 1);
            const nonExamData = data.filter(d => d.isExam === 0);
            weights.examEffect = (examData.reduce((s, d) => s + d.isBooked, 0) / examData.length) -
                                (nonExamData.reduce((s, d) => s + d.isBooked, 0) / nonExamData.length);
            
            const perfData = data.filter(d => d.isPerf === 1);
            const nonPerfData = data.filter(d => d.isPerf === 0);
            weights.perfEffect = (perfData.reduce((s, d) => s + d.isBooked, 0) / perfData.length) -
                                (nonPerfData.reduce((s, d) => s + d.isBooked, 0) / nonPerfData.length);
            
            const eveningData = data.filter(d => d.hour >= 18 && d.hour <= 21);
            const afternoonData = data.filter(d => d.hour >= 14 && d.hour <= 17);
            const morningData = data.filter(d => d.hour >= 9 && d.hour <= 11);
            const otherData = data.filter(d => d.hour >= 12 && d.hour <= 13);
            
            const otherAvg = otherData.reduce((s, d) => s + d.isBooked, 0) / otherData.length;
            weights.eveningEffect = (eveningData.reduce((s, d) => s + d.isBooked, 0) / eveningData.length) - otherAvg;
            weights.afternoonEffect = (afternoonData.reduce((s, d) => s + d.isBooked, 0) / afternoonData.length) - otherAvg;
            weights.morningEffect = (morningData.reduce((s, d) => s + d.isBooked, 0) / morningData.length) - otherAvg;
            
            weights.baseProb = data.reduce((s, d) => s + d.isBooked, 0) / data.length;
            
            return weights;
        }
        
        function calculateLeadTime(dateStr, hour) {
            const now = new Date();
            const targetDate = new Date(dateStr);
            targetDate.setHours(hour, 0, 0, 0);
            const leadTimeHours = (targetDate - now) / (1000 * 60 * 60);
            return Math.max(0, leadTimeHours);
        }
        
        function predictWithModel(dateStr, hour, weights) {
            const date = new Date(dateStr);
            const weekday = date.getDay();
            const periodInfo = getPeriodInfo(dateStr);
            const leadTime = calculateLeadTime(dateStr, hour);
            
            let prob = weights.baseProb;
            
            if (periodInfo.isHoliday) prob += weights.holidayEffect * 0.8;
            if (periodInfo.isExam) prob += weights.examEffect * 1.2;
            if (periodInfo.isPerf) prob += weights.perfEffect * 1.0;
            
            if (hour >= 18 && hour <= 21) prob += weights.eveningEffect;
            else if (hour >= 14 && hour <= 17) prob += weights.afternoonEffect;
            else if (hour >= 9 && hour <= 11) prob += weights.morningEffect;
            
            let timeFactor = 1.0;
            if (leadTime < 6) timeFactor = 0.85;
            else if (leadTime < 24) timeFactor = 0.70;
            else if (leadTime < 72) timeFactor = 0.55;
            else if (leadTime < 168) timeFactor = 0.40;
            else if (leadTime < 336) timeFactor = 0.25;
            else timeFactor = 0.15;
            
            prob = prob * timeFactor;
            
            const noise = (Math.random() - 0.5) * 0.05;
            prob = Math.max(0.05, Math.min(0.95, prob + noise));
            
            return { probability: prob * 100, leadTime: leadTime };
        }
        
        function initializeModel() {
            document.getElementById('dataStatus').innerHTML = 'â³ í•™ìŠµ ë°ì´í„° ìƒì„± ë° ëª¨ë¸ í•™ìŠµ ì¤‘...';
            document.getElementById('dataStatus').className = 'alert alert-info';
            
            setTimeout(() => {
                trainingData = generateTrainingData();
                modelWeights = trainSimulatedModel(trainingData);
                
                document.getElementById('dataStatus').className = 'alert alert-success';
                document.getElementById('dataStatus').innerHTML = `âœ… ML ëª¨ë¸ í•™ìŠµ ì™„ë£Œ! (${trainingData.length}ê°œ ë ˆì½”ë“œ)`;
                
                document.getElementById('dataPreviewSection').classList.remove('hidden');
                renderDataPreview();
                
                document.getElementById('dateWarning').classList.add('hidden');
                document.getElementById('datePickerSection').classList.remove('hidden');
                
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                const minDate2026 = '2026-01-01';
                const minDate = todayStr > minDate2026 ? todayStr : minDate2026;
                const defaultDate = minDate;  // ê¸°ë³¸ê°’ì„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •
                
                document.getElementById('datePicker').value = defaultDate > '2026-12-31' ? '2026-12-31' : defaultDate;
                document.getElementById('datePicker').min = minDate > '2026-12-31' ? '2026-12-31' : minDate;
                document.getElementById('datePicker').max = '2026-12-31';
                
                onDateChange();
            }, 500);
        }
        
        function renderDataPreview() {
            const preview = trainingData.slice(0, 20);
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì›”</th>
                            <th>ì¼</th>
                            <th>ìš”ì¼</th>
                            <th>ì‹œê°„ëŒ€</th>
                            <th>íœ´ì¼</th>
                            <th>ì‹œí—˜ê¸°ê°„</th>
                            <th>ê³µì—°ì‹œì¦Œ</th>
                            <th>ì˜ˆì•½</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const row of preview) {
                html += `
                    <tr>
                        <td>${row.month}</td>
                        <td>${row.day}</td>
                        <td>${WEEKDAY_NAMES_PY[row.weekday]}</td>
                        <td>${row.hour}:00~${row.hour + 1}:00</td>
                        <td>${row.isHoliday ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</td>
                        <td>${row.isExam ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</td>
                        <td>${row.isPerf ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</td>
                        <td>${row.isBooked ? 'ì˜ˆì•½ë¨' : 'ë¯¸ì˜ˆì•½'}</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            document.getElementById('dataPreview').innerHTML = html;
        }
        
        function toggleDataPreview() {
            const preview = document.getElementById('dataPreview');
            const header = document.querySelector('.expandable');
            preview.classList.toggle('hidden');
            header.classList.toggle('expanded');
        }
        
        function onDateChange() {
            const dateInput = document.getElementById('datePicker').value;
            if (!dateInput || !modelWeights) return;
            
            selectedDate = new Date(dateInput);
            selectedTimeSlot = null;
            currentPeriodInfo = getPeriodInfo(dateInput);
            
            const weekday = selectedDate.getDay();
            const weekdayName = WEEKDAY_NAMES[weekday];
            
            let periodBadges = '';
            if (currentPeriodInfo.isHoliday) {
                periodBadges += '<span class="period-badge badge-holiday">ğŸ‰ íœ´ì¼</span>';
            }
            if (currentPeriodInfo.isExam) {
                periodBadges += '<span class="period-badge badge-exam">ğŸ“š ì‹œí—˜ê¸°ê°„</span>';
            }
            if (currentPeriodInfo.isPerf) {
                periodBadges += '<span class="period-badge badge-perf">ğŸ­ ê³µì—°ì‹œì¦Œ</span>';
            }
            if (!currentPeriodInfo.isHoliday && !currentPeriodInfo.isExam && !currentPeriodInfo.isPerf) {
                periodBadges = '<span class="period-badge badge-normal">ğŸ“† í‰ì¼</span>';
            }
            
            const dateInfoHtml = `
                <div class="date-info-row">
                    <span>ì„ íƒ ë‚ ì§œ</span>
                    <strong>${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼</strong>
                </div>
                <div class="date-info-row">
                    <span>ìš”ì¼</span>
                    <strong>${weekdayName}</strong>
                </div>
                <div class="date-info-row">
                    <span>ê¸°ê°„ íŠ¹ì„±</span>
                    <div>${periodBadges}</div>
                </div>
            `;
            
            document.getElementById('dateInfo').innerHTML = dateInfoHtml;
            document.getElementById('dateInfo').classList.remove('hidden');
            
            let alertsHtml = '';
            if (currentPeriodInfo.isExam) {
                alertsHtml += '<div class="alert alert-exam">ğŸ“š ì‹œí—˜ê¸°ê°„ì—ëŠ” ì˜ˆì•½ ìˆ˜ìš”ê°€ ë‚®ìŠµë‹ˆë‹¤. ì—¬ìœ ë¡­ê²Œ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>';
            }
            if (currentPeriodInfo.isPerf) {
                alertsHtml += '<div class="alert alert-perf">ğŸ­ ê³µì—°ì‹œì¦Œì—ëŠ” ì—°ìŠµì‹¤ ìˆ˜ìš”ê°€ ì¦ê°€í•©ë‹ˆë‹¤.</div>';
            }
            document.getElementById('periodAlerts').innerHTML = alertsHtml;
            
            calculateRisks(dateInput);
        }
        
        let bookedSlots = new Set();
        
        function seededRandomForDate(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }
        
        function calculateRisks(dateStr) {
            riskData = {};
            bookedSlots = new Set();
            
            // ë‚ ì§œë³„ ì‹œë“œë¡œ ì¼ê´€ëœ ë§ˆê° ì‹œê°„ëŒ€ ìƒì„±
            const date = new Date(dateStr);
            const dateSeed = date.getFullYear() * 10000 + (date.getMonth() + 1) * 100 + date.getDate();
            
            // ë¨¼ì € ì˜ˆì¸¡ê°’ ê³„ì‚°
            for (const hour of TIME_SLOTS) {
                const result = predictWithModel(dateStr, hour, modelWeights);
                riskData[hour] = { probability: result.probability, leadTime: result.leadTime, isBooked: false };
            }
            
            // ìˆ˜ìš” ê¸°ë°˜ ë§ˆê° ì‹œê°„ëŒ€ ê²°ì •
            for (const hour of TIME_SLOTS) {
                const prob = riskData[hour].probability;
                let closeChance = (prob / 100) * 0.4;  // ìµœëŒ€ 40% í™•ë¥ ë¡œ ë§ˆê°
                
                if (currentPeriodInfo.isPerf) closeChance *= 1.5;  // ê³µì—°ì‹œì¦Œì—” ë§ˆê° í™•ë¥  1.5ë°°
                if (currentPeriodInfo.isHoliday) closeChance *= 1.3;  // íœ´ì¼ì—” ë§ˆê° í™•ë¥  1.3ë°°
                if (currentPeriodInfo.isExam) closeChance *= 0.3;  // ì‹œí—˜ê¸°ê°„ì—” ë§ˆê° í™•ë¥  0.3ë°°
                
                // ì €ë… í”¼í¬ ì‹œê°„ëŒ€ ë§ˆê° í™•ë¥  ì¦ê°€
                if (hour >= 18 && hour <= 20) closeChance *= 1.4;
                
                const randVal = seededRandomForDate(dateSeed + hour * 7);
                if (randVal < closeChance) {
                    bookedSlots.add(hour);
                    riskData[hour].isBooked = true;
                }
            }
            
            // ë§ˆê°ëœ ì‹œê°„ëŒ€ê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ ì œê±°
            selectedTimeSlots = selectedTimeSlots.filter(h => !bookedSlots.has(h));
            
            renderChart();
            renderTimeSlots();
            
            document.getElementById('riskWarning').classList.add('hidden');
            document.getElementById('chartSection').classList.remove('hidden');
            
            // ë§ˆê°ëœ ì‹œê°„ëŒ€ ìˆ˜ í‘œì‹œ
            if (bookedSlots.size > 0) {
                document.getElementById('periodAlerts').innerHTML += 
                    `<div class="alert alert-warning">âš ï¸ ${bookedSlots.size}ê°œ ì‹œê°„ëŒ€ê°€ ì´ë¯¸ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;
            }
            
            updateBookingSection();
        }
        
        function getRiskLevel(probability) {
            if (probability >= 75) {
                return { level: 'ìœ„í—˜', color: '#FF4B4B', emoji: 'ğŸ”´', class: 'slot-danger' };
            } else if (probability >= 50) {
                return { level: 'ì„ë°•', color: '#FFA500', emoji: 'ğŸŸ ', class: 'slot-imminent' };
            } else if (probability >= 25) {
                return { level: 'ì£¼ì˜', color: '#FFD700', emoji: 'ğŸŸ¡', class: 'slot-caution' };
            } else {
                return { level: 'ì—¬ìœ ', color: '#00CC66', emoji: 'ğŸŸ¢', class: 'slot-safe' };
            }
        }
        
        function renderChart() {
            const hours = TIME_SLOTS.map(h => `${h}:00`);
            const probabilities = TIME_SLOTS.map(h => riskData[h].probability);
            const colors = TIME_SLOTS.map(h => getRiskLevel(riskData[h].probability).color);
            
            const trace = {
                x: hours,
                y: probabilities,
                type: 'bar',
                marker: { color: colors },
                text: probabilities.map(p => `${p.toFixed(0)}%`),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>ë§ˆê° í™•ë¥ : %{y:.1f}%<extra></extra>'
            };
            
            const layout = {
                title: {
                    text: 'ì‹œê°„ëŒ€ë³„ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ (ML ì˜ˆì¸¡)',
                    font: { size: 18 }
                },
                xaxis: { title: 'ì‹œê°„ëŒ€' },
                yaxis: { title: 'ë§ˆê° í™•ë¥  (%)', range: [0, 110] },
                height: 400,
                showlegend: false,
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                shapes: [
                    {
                        type: 'line',
                        x0: -0.5, x1: TIME_SLOTS.length - 0.5,
                        y0: 75, y1: 75,
                        line: { color: '#FF4B4B', dash: 'dash', width: 1 }
                    },
                    {
                        type: 'line',
                        x0: -0.5, x1: TIME_SLOTS.length - 0.5,
                        y0: 50, y1: 50,
                        line: { color: '#FFA500', dash: 'dash', width: 1 }
                    },
                    {
                        type: 'line',
                        x0: -0.5, x1: TIME_SLOTS.length - 0.5,
                        y0: 25, y1: 25,
                        line: { color: '#FFD700', dash: 'dash', width: 1 }
                    }
                ]
            };
            
            Plotly.newPlot('chart', [trace], layout, { responsive: true });
        }
        
        function renderTimeSlots() {
            let html = '<p style="color: #666; margin-bottom: 12px;">â° ì´ë¯¸ ì§€ë‚œ ì‹œê°„ëŒ€ì™€ ë§ˆê°ëœ ì‹œê°„ëŒ€ëŠ” ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í´ë¦­í•˜ì—¬ ë³µìˆ˜ ì„ íƒ/í•´ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>';
            
            const now = new Date();
            const currentHour = now.getHours();
            const todayStr = now.toISOString().split('T')[0];
            const selectedDateStr = document.getElementById('datePicker').value;
            const isToday = selectedDateStr === todayStr;
            
            for (const hour of TIME_SLOTS) {
                const data = riskData[hour];
                const prob = data.probability;
                const risk = getRiskLevel(prob);
                const isSelected = selectedTimeSlots.includes(hour);
                const selected = isSelected ? 'selected' : '';
                const isPastTime = isToday && hour <= currentHour;
                const isBooked = data.isBooked;
                
                if (isPastTime) {
                    html += `
                        <div class="time-slot slot-disabled" title="ì´ë¯¸ ì§€ë‚œ ì‹œê°„ì…ë‹ˆë‹¤">
                            <div class="time-slot-time">${hour}:00</div>
                            <div class="time-slot-risk">â›” ì§€ë‚¨</div>
                        </div>
                    `;
                } else if (isBooked) {
                    html += `
                        <div class="time-slot slot-disabled" title="ì´ë¯¸ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤" style="background: #ffebee;">
                            <div class="time-slot-time">${hour}:00</div>
                            <div class="time-slot-risk">ğŸš« ë§ˆê°</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="time-slot ${risk.class} ${selected}" onclick="toggleTimeSlot(${hour})">
                            <div class="time-slot-time">${isSelected ? 'âœ… ' : ''}${hour}:00</div>
                            <div class="time-slot-risk">${risk.emoji} ${risk.level}</div>
                            <div style="font-size: 0.8rem; margin-top: 4px;">${prob.toFixed(0)}%</div>
                        </div>
                    `;
                }
            }
            
            document.getElementById('timeSlots').innerHTML = html;
        }
        
        function toggleTimeSlot(hour) {
            const index = selectedTimeSlots.indexOf(hour);
            if (index > -1) {
                selectedTimeSlots.splice(index, 1);
            } else {
                selectedTimeSlots.push(hour);
                selectedTimeSlots.sort((a, b) => a - b);
            }
            renderTimeSlots();
            updateBookingSection();
        }
        
        function clearSelection() {
            selectedTimeSlots = [];
            renderTimeSlots();
            updateBookingSection();
        }
        
        function formatLeadTime(hours) {
            if (hours < 24) {
                return `${hours.toFixed(1)}ì‹œê°„ ì „`;
            } else if (hours < 168) {
                return `${(hours / 24).toFixed(1)}ì¼ ì „`;
            } else {
                return `${(hours / 168).toFixed(1)}ì£¼ ì „`;
            }
        }
        
        function updateBookingSection() {
            if (selectedTimeSlots.length === 0) {
                document.getElementById('bookingWarning').classList.remove('hidden');
                document.getElementById('bookingSummary').classList.add('hidden');
                return;
            }
            
            document.getElementById('bookingWarning').classList.add('hidden');
            document.getElementById('bookingSummary').classList.remove('hidden');
            
            const totalHours = selectedTimeSlots.length;
            const hourlyRate = 110000;
            const totalPrice = hourlyRate * totalHours;
            
            const timeRanges = selectedTimeSlots.map(h => `${h}:00~${h+1}:00`).join(', ');
            
            const avgProb = selectedTimeSlots.reduce((sum, h) => sum + riskData[h].probability, 0) / totalHours;
            const maxRiskHour = selectedTimeSlots.reduce((max, h) => 
                riskData[h].probability > riskData[max].probability ? h : max, selectedTimeSlots[0]);
            const maxRiskInfo = riskData[maxRiskHour];
            const maxRisk = getRiskLevel(maxRiskInfo.probability);
            
            const firstHour = selectedTimeSlots[0];
            const leadTime = riskData[firstHour].leadTime;
            const weekday = selectedDate.getDay();
            
            let periodStr = [];
            if (currentPeriodInfo.isHoliday) periodStr.push('íœ´ì¼');
            if (currentPeriodInfo.isExam) periodStr.push('ì‹œí—˜ê¸°ê°„');
            if (currentPeriodInfo.isPerf) periodStr.push('ê³µì—°ì‹œì¦Œ');
            const periodText = periodStr.length > 0 ? periodStr.join(', ') : 'í‰ì¼';
            
            let slotDetails = selectedTimeSlots.map(h => {
                const info = riskData[h];
                const risk = getRiskLevel(info.probability);
                return `<div style="font-size: 0.9rem; margin: 2px 0;">${risk.emoji} ${h}:00~${h+1}:00 (${info.probability.toFixed(0)}%)</div>`;
            }).join('');
            
            const bookingHtml = `
                <div class="booking-row">
                    <span>ì˜ˆì•½ ë‚ ì§œ</span>
                    <strong>${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼ (${WEEKDAY_NAMES[weekday]})</strong>
                </div>
                <div class="booking-row">
                    <span>ì˜ˆì•½ ì‹œê°„</span>
                    <strong>${timeRanges} (${totalHours}ì‹œê°„)</strong>
                </div>
                <div class="booking-row">
                    <span>ê¸°ê°„ íŠ¹ì„±</span>
                    <strong>${periodText}</strong>
                </div>
                <div class="booking-row">
                    <span>ì˜ˆì•½ ì‹œì </span>
                    <strong>ğŸ• ${formatLeadTime(leadTime)} (ë¦¬ë“œíƒ€ì„: ${leadTime.toFixed(0)}ì‹œê°„)</strong>
                </div>
                <div class="booking-row">
                    <span>í‰ê·  ë§ˆê° í™•ë¥ </span>
                    <strong style="color: ${maxRisk.color}">${avgProb.toFixed(0)}%</strong>
                </div>
                <div class="booking-row">
                    <span>ì„ íƒëœ ì‹œê°„ëŒ€</span>
                    <div>${slotDetails}</div>
                </div>
                <div class="booking-row">
                    <span>ì˜ˆìƒ ì´ìš©ë£Œ</span>
                    <strong style="color: #7B68EE;">â‚©${totalPrice.toLocaleString()} (${totalHours}ì‹œê°„)</strong>
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="clearSelection()" style="background: #f0f0f0; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">ì„ íƒ ì´ˆê¸°í™”</button>
                </div>
            `;
            
            document.getElementById('bookingDetails').innerHTML = bookingHtml;
            document.getElementById('bookingBtn').textContent = `ğŸ¯ ${totalHours}ì‹œê°„ ì˜ˆì•½í•˜ê¸°`;
        }
        
        function processBooking() {
            if (selectedTimeSlots.length === 0) return;
            
            const totalHours = selectedTimeSlots.length;
            const hourlyRate = 110000;
            const totalPrice = hourlyRate * totalHours;
            const timeRanges = selectedTimeSlots.map(h => `${h}:00~${h+1}:00`).join(', ');
            
            const firstHour = selectedTimeSlots[0];
            const leadTime = riskData[firstHour].leadTime;
            const weekday = selectedDate.getDay();
            
            let periodStr = [];
            if (currentPeriodInfo.isHoliday) periodStr.push('íœ´ì¼');
            if (currentPeriodInfo.isExam) periodStr.push('ì‹œí—˜ê¸°ê°„');
            if (currentPeriodInfo.isPerf) periodStr.push('ê³µì—°ì‹œì¦Œ');
            const periodText = periodStr.length > 0 ? periodStr.join(', ') : 'í‰ì¼';
            
            const modalHtml = `
                <div class="booking-summary" style="text-align: left; margin-top: 20px;">
                    <div class="booking-row">
                        <span>ì˜ˆì•½ ë‚ ì§œ</span>
                        <strong>${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼ (${WEEKDAY_NAMES[weekday]})</strong>
                    </div>
                    <div class="booking-row">
                        <span>ì˜ˆì•½ ì‹œê°„</span>
                        <strong>${timeRanges} (${totalHours}ì‹œê°„)</strong>
                    </div>
                    <div class="booking-row">
                        <span>ì˜ˆì•½ ì‹œì </span>
                        <strong>ğŸ• ${formatLeadTime(leadTime)}</strong>
                    </div>
                    <div class="booking-row">
                        <span>ê¸°ê°„ íŠ¹ì„±</span>
                        <strong>${periodText}</strong>
                    </div>
                    <div class="booking-row">
                        <span>ê²°ì œ ê¸ˆì•¡</span>
                        <strong style="color: #7B68EE; font-size: 1.2rem;">â‚©${totalPrice.toLocaleString()}</strong>
                    </div>
                </div>
            `;
            
            document.getElementById('modalBookingInfo').innerHTML = modalHtml;
            document.getElementById('bookingModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('bookingModal').classList.remove('show');
        }
        
        document.getElementById('bookingModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Tab switching functions
        function switchMainTab(tabName) {
            document.querySelectorAll('.main-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tabName === 'customer') {
                document.querySelector('.main-tab:nth-child(1)').classList.add('active');
                document.getElementById('customerTab').classList.add('active');
            } else {
                document.querySelector('.main-tab:nth-child(2)').classList.add('active');
                document.getElementById('businessTab').classList.add('active');
                updateBizStatus();
            }
        }
        
        function updateBizStatus() {
            if (modelWeights) {
                document.getElementById('bizDataStatus').classList.add('hidden');
                document.getElementById('bizModelReady').classList.remove('hidden');
                document.getElementById('bizAnalysisSection').classList.remove('hidden');
                runAnalysis();
            }
        }
        
        function switchBizTab(tabName) {
            document.querySelectorAll('.biz-subtab').forEach(tab => tab.classList.remove('active'));
            
            if (tabName === 'analysis') {
                document.querySelector('.biz-subtab:nth-child(1)').classList.add('active');
                document.getElementById('analysisContent').classList.remove('hidden');
                document.getElementById('promoContent').classList.add('hidden');
                runAnalysis();
            } else {
                document.querySelector('.biz-subtab:nth-child(2)').classList.add('active');
                document.getElementById('analysisContent').classList.add('hidden');
                document.getElementById('promoContent').classList.remove('hidden');
                initPromoDate();
            }
        }
        
        function initPromoDate() {
            const today = new Date();
            const minDate = new Date(2026, 0, 1);
            const defaultDate = today < minDate ? minDate : today;
            const promoDateInput = document.getElementById('promoDate');
            promoDateInput.min = minDate.toISOString().split('T')[0];
            promoDateInput.max = '2026-12-31';
            promoDateInput.value = defaultDate.toISOString().split('T')[0];
        }
        
        let promoSlotStatus = {};
        
        function runAnalysis() {
            if (!modelWeights) return;
            
            const analysisType = document.getElementById('analysisType').value;
            let labels = [];
            let values = [];
            let colors = [];
            
            const getColor = (val) => {
                if (val > 60) return '#FF4B4B';
                if (val > 40) return '#FFA500';
                if (val > 25) return '#FFD700';
                return '#00CC66';
            };
            
            if (analysisType === 'monthly') {
                for (let month = 1; month <= 12; month++) {
                    let probs = [];
                    for (const day of [10, 15, 20]) {
                        for (const hour of TIME_SLOTS) {
                            try {
                                const dateStr = `2026-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                const result = predictWithModel(dateStr, hour, modelWeights);
                                probs.push(result.probability);
                            } catch (e) {}
                        }
                    }
                    if (probs.length > 0) {
                        const avg = probs.reduce((a, b) => a + b, 0) / probs.length;
                        labels.push(`${month}ì›”`);
                        values.push(avg);
                        colors.push(getColor(avg));
                    }
                }
            } else if (analysisType === 'weekday') {
                const weekdayProbs = {0: [], 1: [], 2: [], 3: [], 4: [], 5: [], 6: []};
                for (const month of [3, 6, 9, 11]) {
                    for (let day = 1; day <= 28; day++) {
                        try {
                            const dateStr = `2026-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            const date = new Date(dateStr);
                            const weekday = (date.getDay() + 6) % 7;
                            for (const hour of TIME_SLOTS) {
                                const result = predictWithModel(dateStr, hour, modelWeights);
                                weekdayProbs[weekday].push(result.probability);
                            }
                        } catch (e) {}
                    }
                }
                for (let wd = 0; wd < 7; wd++) {
                    if (weekdayProbs[wd].length > 0) {
                        const avg = weekdayProbs[wd].reduce((a, b) => a + b, 0) / weekdayProbs[wd].length;
                        labels.push(WEEKDAY_NAMES_PY[wd]);
                        values.push(avg);
                        colors.push(getColor(avg));
                    }
                }
            } else if (analysisType === 'hourly') {
                const hourProbs = {};
                TIME_SLOTS.forEach(h => hourProbs[h] = []);
                for (const month of [3, 6, 9, 11]) {
                    for (const day of [10, 15, 20]) {
                        try {
                            const dateStr = `2026-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            for (const hour of TIME_SLOTS) {
                                const result = predictWithModel(dateStr, hour, modelWeights);
                                hourProbs[hour].push(result.probability);
                            }
                        } catch (e) {}
                    }
                }
                for (const hour of TIME_SLOTS) {
                    if (hourProbs[hour].length > 0) {
                        const avg = hourProbs[hour].reduce((a, b) => a + b, 0) / hourProbs[hour].length;
                        labels.push(`${hour}:00`);
                        values.push(avg);
                        colors.push(getColor(avg));
                    }
                }
            } else if (analysisType === 'period') {
                const periodProbs = {'í‰ì¼': [], 'íœ´ì¼/ì£¼ë§': [], 'ì‹œí—˜ê¸°ê°„': [], 'ê³µì—°ì‹œì¦Œ': []};
                for (let month = 1; month <= 12; month++) {
                    for (let day = 1; day <= 28; day++) {
                        try {
                            const dateStr = `2026-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            const period = getPeriodInfo(dateStr);
                            for (const hour of TIME_SLOTS) {
                                const result = predictWithModel(dateStr, hour, modelWeights);
                                if (period.isExam) periodProbs['ì‹œí—˜ê¸°ê°„'].push(result.probability);
                                else if (period.isPerf) periodProbs['ê³µì—°ì‹œì¦Œ'].push(result.probability);
                                else if (period.isHoliday) periodProbs['íœ´ì¼/ì£¼ë§'].push(result.probability);
                                else periodProbs['í‰ì¼'].push(result.probability);
                            }
                        } catch (e) {}
                    }
                }
                const periodColors = {'í‰ì¼': '#00CC66', 'íœ´ì¼/ì£¼ë§': '#FFA500', 'ì‹œí—˜ê¸°ê°„': '#3498db', 'ê³µì—°ì‹œì¦Œ': '#FF4B4B'};
                for (const [period, probs] of Object.entries(periodProbs)) {
                    if (probs.length > 0) {
                        const avg = probs.reduce((a, b) => a + b, 0) / probs.length;
                        labels.push(period);
                        values.push(avg);
                        colors.push(periodColors[period]);
                    }
                }
            }
            
            const trace = {
                x: labels,
                y: values,
                type: 'bar',
                marker: { color: colors },
                text: values.map(v => `${v.toFixed(0)}%`),
                textposition: 'outside'
            };
            
            const titles = {
                'monthly': 'ì›”ë³„ í‰ê·  ì˜ˆì•½ ìˆ˜ìš”',
                'weekday': 'ìš”ì¼ë³„ í‰ê·  ì˜ˆì•½ ìˆ˜ìš”',
                'hourly': 'ì‹œê°„ëŒ€ë³„ í‰ê·  ì˜ˆì•½ ìˆ˜ìš”',
                'period': 'ê¸°ê°„ íŠ¹ì„±ë³„ í‰ê·  ì˜ˆì•½ ìˆ˜ìš”'
            };
            
            const layout = {
                title: titles[analysisType],
                yaxis: { title: 'ìˆ˜ìš” (%)', range: [0, Math.max(...values) * 1.2] },
                height: 400,
                showlegend: false
            };
            
            Plotly.newPlot('analysisChart', [trace], layout, { responsive: true });
        }
        
        function analyzePromoSlots() {
            if (!modelWeights) return;
            
            const promoDateStr = document.getElementById('promoDate').value;
            if (!promoDateStr) return;
            
            const threshold = parseInt(document.getElementById('promoThreshold').value);
            document.getElementById('thresholdValue').textContent = threshold + '%';
            
            if (!promoSlotStatus[promoDateStr]) {
                promoSlotStatus[promoDateStr] = {};
            }
            
            const lowDemandSlots = [];
            
            for (const hour of TIME_SLOTS) {
                const result = predictWithModel(promoDateStr, hour, modelWeights);
                if (result.probability < threshold) {
                    lowDemandSlots.push({ hour, prob: result.probability });
                }
            }
            
            if (lowDemandSlots.length === 0) {
                document.getElementById('promoWarning').classList.remove('hidden');
                document.getElementById('promoWarning').innerHTML = `âœ… ëª¨ë“  ì‹œê°„ëŒ€ì˜ ìˆ˜ìš”ê°€ ${threshold}% ì´ìƒì…ë‹ˆë‹¤. í”„ë¡œëª¨ì…˜ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`;
                document.getElementById('promoWarning').className = 'alert alert-success';
                document.getElementById('promoSlotsContainer').classList.add('hidden');
                return;
            }
            
            document.getElementById('promoWarning').classList.add('hidden');
            document.getElementById('promoSlotsContainer').classList.remove('hidden');
            document.getElementById('promoInfo').innerHTML = `<div class="alert alert-warning">ğŸ“‰ ${lowDemandSlots.length}ê°œ ì €ìˆ˜ìš” ì‹œê°„ëŒ€ ë°œê²¬ (ìˆ˜ìš” ${threshold}% ë¯¸ë§Œ)</div>`;
            
            let slotsHtml = '';
            for (const slot of lowDemandSlots) {
                const currentStatus = promoSlotStatus[promoDateStr][slot.hour] || 'ì¼ë°˜';
                const slotClass = currentStatus === 'ì˜¤í”ˆì—°ìŠµì‹¤' ? 'open-practice' : currentStatus === 'íƒ€ì„ì„¸ì¼' ? 'time-sale' : '';
                
                slotsHtml += `
                    <div class="promo-slot ${slotClass}">
                        <strong>${slot.hour}:00</strong><br>
                        <span style="color: #666; font-size: 0.8rem;">ìˆ˜ìš”: ${slot.prob.toFixed(0)}%</span>
                        <select class="promo-select" onchange="updatePromoSlot('${promoDateStr}', ${slot.hour}, this.value)">
                            <option value="ì¼ë°˜" ${currentStatus === 'ì¼ë°˜' ? 'selected' : ''}>ì¼ë°˜</option>
                            <option value="ì˜¤í”ˆì—°ìŠµì‹¤" ${currentStatus === 'ì˜¤í”ˆì—°ìŠµì‹¤' ? 'selected' : ''}>ì˜¤í”ˆì—°ìŠµì‹¤</option>
                            <option value="íƒ€ì„ì„¸ì¼" ${currentStatus === 'íƒ€ì„ì„¸ì¼' ? 'selected' : ''}>íƒ€ì„ì„¸ì¼</option>
                        </select>
                    </div>
                `;
            }
            
            document.getElementById('promoSlots').innerHTML = slotsHtml;
            updatePromoSummary(promoDateStr);
        }
        
        function updatePromoSlot(dateStr, hour, status) {
            if (!promoSlotStatus[dateStr]) promoSlotStatus[dateStr] = {};
            promoSlotStatus[dateStr][hour] = status;
            analyzePromoSlots();
        }
        
        function updatePromoSummary(dateStr) {
            const slots = promoSlotStatus[dateStr] || {};
            const openPractice = Object.entries(slots).filter(([h, s]) => s === 'ì˜¤í”ˆì—°ìŠµì‹¤').map(([h]) => parseInt(h)).sort((a,b) => a-b);
            const timeSale = Object.entries(slots).filter(([h, s]) => s === 'íƒ€ì„ì„¸ì¼').map(([h]) => parseInt(h)).sort((a,b) => a-b);
            
            document.getElementById('openPracticeCount').textContent = `${openPractice.length}ê°œ ì‹œê°„ëŒ€`;
            document.getElementById('openPracticeSlots').innerHTML = openPractice.length > 0 ? openPractice.map(h => `${h}:00`).join(', ') : '';
            
            document.getElementById('timeSaleCount').textContent = `${timeSale.length}ê°œ ì‹œê°„ëŒ€`;
            document.getElementById('timeSaleSlots').innerHTML = timeSale.length > 0 ? timeSale.map(h => `${h}:00`).join(', ') : '';
        }
    </script>
</body>
</html>
