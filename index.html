<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ìŠµì‹¤ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ ì˜ˆì¸¡ (2026)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 16px;
            color: #1f1f1f;
        }
        
        h2 {
            font-size: 1.25rem;
            margin-bottom: 12px;
            color: #1f1f1f;
        }
        
        .intro {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .intro p {
            margin-bottom: 8px;
        }
        
        .ml-badge {
            display: inline-block;
            background: linear-gradient(135deg, #7B68EE, #9370DB);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 8px;
        }
        
        .risk-legend {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .risk-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .risk-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .risk-danger { background: #FF4B4B; }
        .risk-imminent { background: #FFA500; }
        .risk-caution { background: #FFD700; }
        .risk-safe { background: #00CC66; }
        
        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 20px 0;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #FF4B4B;
            color: white;
        }
        
        .btn-primary:hover {
            background: #e04343;
        }
        
        .btn-secondary {
            background: #f0f2f6;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e0e2e6;
        }
        
        .btn-book {
            background: #0066FF;
            color: white;
            padding: 14px 32px;
            font-size: 1.1rem;
        }
        
        .btn-book:hover {
            background: #0052cc;
        }
        
        .btn-book:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .alert-info {
            background: #e7f3ff;
            border-left: 4px solid #0066FF;
            color: #0052cc;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .alert-exam {
            background: #fff0f0;
            border-left: 4px solid #FF4B4B;
            color: #cc0000;
        }
        
        .alert-perf {
            background: #f0f0ff;
            border-left: 4px solid #7B68EE;
            color: #5a4fcf;
        }
        
        .date-picker {
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .date-info {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .date-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .date-info-row:last-child {
            border-bottom: none;
        }
        
        .period-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-right: 8px;
        }
        
        .badge-holiday {
            background: #ffe0e0;
            color: #cc0000;
        }
        
        .badge-exam {
            background: #fff0e0;
            color: #cc6600;
        }
        
        .badge-perf {
            background: #e0e0ff;
            color: #6600cc;
        }
        
        .badge-normal {
            background: #e0f0e0;
            color: #006600;
        }
        
        #chart {
            width: 100%;
            height: 400px;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 16px;
        }
        
        .time-slot {
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .time-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .time-slot.selected {
            border: 2px solid #0066FF;
        }
        
        .time-slot-time {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .time-slot-risk {
            font-size: 0.85rem;
        }
        
        .slot-danger {
            background: linear-gradient(135deg, #FF4B4B 0%, #ff6b6b 100%);
            color: white;
        }
        
        .slot-imminent {
            background: linear-gradient(135deg, #FFA500 0%, #ffb733 100%);
            color: white;
        }
        
        .slot-caution {
            background: linear-gradient(135deg, #FFD700 0%, #ffe033 100%);
            color: #333;
        }
        
        .slot-safe {
            background: linear-gradient(135deg, #00CC66 0%, #33d685 100%);
            color: white;
        }
        
        .slot-disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .slot-disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .booking-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .booking-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .booking-row:last-child {
            border-bottom: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .modal-content h2 {
            margin-bottom: 20px;
        }
        
        .modal-content p {
            margin-bottom: 20px;
            color: #666;
        }
        
        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }
        
        .expandable {
            cursor: pointer;
        }
        
        .expandable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-top: 16px;
        }
        
        .expandable-header:hover {
            background: #e9ecef;
        }
        
        .expand-icon {
            transition: transform 0.2s;
        }
        
        .expanded .expand-icon {
            transform: rotate(180deg);
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ ì—°ìŠµì‹¤ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ ì˜ˆì¸¡ (2026) <span class="ml-badge">ML ê¸°ë°˜</span></h1>
        
        <div class="intro">
            <p>ì´ ì„œë¹„ìŠ¤ëŠ” <strong>ë¨¸ì‹ ëŸ¬ë‹(RandomForest) ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ ì˜ˆì•½ ë§ˆê° í™•ë¥ </strong>ì„ ì œê³µí•˜ì—¬ ì‚¬ìš©ìê°€ ë” í•©ë¦¬ì ìœ¼ë¡œ ì˜ˆì•½ ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.</p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 12px;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 8px; text-align: center;">ë‹¨ê³„</th>
                        <th style="padding: 8px; text-align: center;">ìœ„í—˜ë„</th>
                        <th style="padding: 8px; text-align: center;">ë§ˆê° í™•ë¥ </th>
                        <th style="padding: 8px; text-align: left;">ì˜ë¯¸</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸŸ¢</td>
                        <td style="padding: 8px; text-align: center;"><strong>ì—¬ìœ </strong></td>
                        <td style="padding: 8px; text-align: center;">0~25%</td>
                        <td style="padding: 8px;">ì§€ê¸ˆ ì˜ˆì•½í•˜ì§€ ì•Šì•„ë„ ì¶©ë¶„íˆ ì—¬ìœ  ìˆìŒ</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸŸ¡</td>
                        <td style="padding: 8px; text-align: center;"><strong>ì£¼ì˜</strong></td>
                        <td style="padding: 8px; text-align: center;">25~50%</td>
                        <td style="padding: 8px;">ì¡°ê¸ˆì”© ì°° ê°€ëŠ¥ì„± ìˆìŒ</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸŸ </td>
                        <td style="padding: 8px; text-align: center;"><strong>ì„ë°•</strong></td>
                        <td style="padding: 8px; text-align: center;">50~75%</td>
                        <td style="padding: 8px;">ì˜ˆì•½ ì§€ì—° ì‹œ í™•ë³´ ì–´ë ¤ì›€</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: center;">ğŸ”´</td>
                        <td style="padding: 8px; text-align: center;"><strong>ìœ„í—˜</strong></td>
                        <td style="padding: 8px; text-align: center;">75~100%</td>
                        <td style="padding: 8px;">ë¹ ë¥¸ ì˜ˆì•½ í•„ìš”</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="divider"></div>
        
        <div class="section">
            <h2>1. ML ëª¨ë¸ ì¤€ë¹„</h2>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="initializeModel()">ğŸ“Š ML ëª¨ë¸ í•™ìŠµ</button>
            </div>
            <div id="dataStatus" class="alert alert-warning">
                âš ï¸ 'ML ëª¨ë¸ í•™ìŠµ' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
            </div>
            
            <div id="dataPreviewSection" class="hidden">
                <div class="expandable" onclick="toggleDataPreview()">
                    <div class="expandable-header">
                        <span>ğŸ“‹ í•™ìŠµ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (ì²˜ìŒ 20ê°œ í–‰)</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                </div>
                <div id="dataPreview" class="data-preview hidden"></div>
            </div>
        </div>
        
        <div class="section" id="dateSection">
            <h2>2. 2026ë…„ ë‚ ì§œ ì„ íƒ</h2>
            <div id="dateWarning" class="alert alert-warning">
                âš ï¸ ë¨¼ì € 'ML ëª¨ë¸ í•™ìŠµ' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
            </div>
            <div id="datePickerSection" class="hidden">
                <label for="datePicker">ì˜ˆì•½ í¬ë§ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
                <br>
                <input type="date" id="datePicker" class="date-picker" onchange="onDateChange()">
                <div id="dateInfo" class="date-info hidden"></div>
                <div id="periodAlerts"></div>
            </div>
        </div>
        
        <div class="section" id="riskSection">
            <h2>3. ì‹œê°„ëŒ€ë³„ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ (ML ì˜ˆì¸¡)</h2>
            <div id="riskWarning" class="alert alert-warning">
                âš ï¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
            </div>
            <div id="chartSection" class="hidden">
                <div id="chart"></div>
                
                <h3 style="margin-top: 24px; margin-bottom: 12px;">ì‹œê°„ëŒ€ ì„ íƒ</h3>
                <p style="color: #666; margin-bottom: 12px;">ì˜ˆì•½í•  ì‹œê°„ëŒ€ë¥¼ í´ë¦­í•˜ì„¸ìš”:</p>
                <div id="timeSlots" class="time-slots"></div>
            </div>
        </div>
        
        <div class="section" id="bookingSection">
            <h2>4. ì˜ˆì•½í•˜ê¸°</h2>
            <div id="bookingWarning" class="alert alert-warning">
                âš ï¸ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
            </div>
            <div id="bookingSummary" class="booking-summary hidden">
                <h3 style="margin-bottom: 16px;">ì˜ˆì•½ ì •ë³´ í™•ì¸ (ML ì˜ˆì¸¡)</h3>
                <div id="bookingDetails"></div>
                <div style="margin-top: 20px; text-align: center;">
                    <button id="bookingBtn" class="btn btn-book" onclick="processBooking()">ğŸ¯ ì˜ˆì•½í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ‰ ì˜ˆì•½ ì‹ ì²­ ì™„ë£Œ!</h2>
            <p>ê²°ì œ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br><br><strong>(PoC ë°ëª¨ - ì‹¤ì œ ê²°ì œ ì—°ë™ ì—†ìŒ)</strong></p>
            <div id="modalBookingInfo"></div>
            <button class="btn btn-primary" style="margin-top: 20px;" onclick="closeModal()">í™•ì¸</button>
        </div>
    </div>
    
    <script>
        const WEEKDAY_NAMES = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        const WEEKDAY_NAMES_PY = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
        const TIME_SLOTS = [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22];
        
        const HOLIDAYS_2026 = [
            '2026-01-01', '2026-03-01', '2026-03-02', '2026-05-05',
            '2026-05-24', '2026-06-06', '2026-08-15', '2026-10-03',
            '2026-10-09', '2026-12-25'
        ];
        
        const EXAM_PERIODS_2026 = [
            ['2026-04-13', '2026-04-24'],
            ['2026-06-08', '2026-06-19'],
            ['2026-10-12', '2026-10-23'],
            ['2026-12-07', '2026-12-18']
        ];
        
        const PERFORMANCE_SEASONS_2026 = [
            ['2026-05-11', '2026-06-05'],
            ['2026-11-02', '2026-11-27']
        ];
        
        let trainingData = null;
        let modelWeights = null;
        let selectedDate = null;
        let selectedTimeSlots = [];
        let riskData = {};
        let currentPeriodInfo = {};
        
        function seededRandom(seed) {
            const x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }
        
        function isInPeriod(dateStr, periods) {
            const targetDate = new Date(dateStr);
            for (const [startStr, endStr] of periods) {
                const start = new Date(startStr);
                const end = new Date(endStr);
                if (targetDate >= start && targetDate <= end) {
                    return true;
                }
            }
            return false;
        }
        
        function getPeriodInfo(dateStr) {
            const date = new Date(dateStr);
            const weekday = date.getDay();
            const isWeekend = weekday === 0 || weekday === 6;
            const isHoliday = isWeekend || HOLIDAYS_2026.includes(dateStr);
            const isExam = isInPeriod(dateStr, EXAM_PERIODS_2026);
            const isPerf = isInPeriod(dateStr, PERFORMANCE_SEASONS_2026);
            
            return {
                isHoliday,
                isExam,
                isPerf
            };
        }
        
        function generateTrainingData() {
            const data = [];
            const startDate = new Date(2025, 0, 1);
            const endDate = new Date(2025, 11, 31);
            let seed = 42;
            
            const examPeriods2025 = [
                ['2025-04-14', '2025-04-25'],
                ['2025-06-09', '2025-06-20'],
                ['2025-10-13', '2025-10-24'],
                ['2025-12-08', '2025-12-19']
            ];
            
            const perfSeasons2025 = [
                ['2025-05-12', '2025-06-06'],
                ['2025-11-03', '2025-11-28']
            ];
            
            const holidays2025 = [
                '2025-01-01', '2025-01-28', '2025-01-29', '2025-01-30',
                '2025-03-01', '2025-05-05', '2025-05-06', '2025-06-06',
                '2025-08-15', '2025-10-03', '2025-10-06', '2025-10-07',
                '2025-10-08', '2025-10-09', '2025-12-25'
            ];
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                const weekday = d.getDay();
                const pyWeekday = (weekday + 6) % 7;
                const isWeekend = weekday === 0 || weekday === 6;
                const isHoliday = isWeekend || holidays2025.includes(dateStr) ? 1 : 0;
                const isExam = isInPeriod(dateStr, examPeriods2025) ? 1 : 0;
                const isPerf = isInPeriod(dateStr, perfSeasons2025) ? 1 : 0;
                
                for (const hour of TIME_SLOTS) {
                    let baseProb = 0.25;
                    
                    if (isHoliday) baseProb += 0.20;
                    if (isExam) baseProb += 0.25;
                    if (isPerf) baseProb += 0.15;
                    
                    if (hour >= 18 && hour <= 21) baseProb += 0.30;
                    else if (hour >= 14 && hour <= 17) baseProb += 0.15;
                    else if (hour >= 9 && hour <= 11) baseProb += 0.05;
                    
                    const isBooked = seededRandom(seed++) < baseProb ? 1 : 0;
                    
                    data.push({
                        month: d.getMonth() + 1,
                        day: d.getDate(),
                        weekday: pyWeekday,
                        hour: hour,
                        isHoliday: isHoliday,
                        isExam: isExam,
                        isPerf: isPerf,
                        isBooked: isBooked
                    });
                }
            }
            
            return data;
        }
        
        function trainSimulatedModel(data) {
            const weights = {
                baseProb: 0.25,
                holidayEffect: 0,
                examEffect: 0,
                perfEffect: 0,
                eveningEffect: 0,
                afternoonEffect: 0,
                morningEffect: 0
            };
            
            const holidayData = data.filter(d => d.isHoliday === 1);
            const nonHolidayData = data.filter(d => d.isHoliday === 0);
            weights.holidayEffect = (holidayData.reduce((s, d) => s + d.isBooked, 0) / holidayData.length) -
                                   (nonHolidayData.reduce((s, d) => s + d.isBooked, 0) / nonHolidayData.length);
            
            const examData = data.filter(d => d.isExam === 1);
            const nonExamData = data.filter(d => d.isExam === 0);
            weights.examEffect = (examData.reduce((s, d) => s + d.isBooked, 0) / examData.length) -
                                (nonExamData.reduce((s, d) => s + d.isBooked, 0) / nonExamData.length);
            
            const perfData = data.filter(d => d.isPerf === 1);
            const nonPerfData = data.filter(d => d.isPerf === 0);
            weights.perfEffect = (perfData.reduce((s, d) => s + d.isBooked, 0) / perfData.length) -
                                (nonPerfData.reduce((s, d) => s + d.isBooked, 0) / nonPerfData.length);
            
            const eveningData = data.filter(d => d.hour >= 18 && d.hour <= 21);
            const afternoonData = data.filter(d => d.hour >= 14 && d.hour <= 17);
            const morningData = data.filter(d => d.hour >= 9 && d.hour <= 11);
            const otherData = data.filter(d => d.hour >= 12 && d.hour <= 13);
            
            const otherAvg = otherData.reduce((s, d) => s + d.isBooked, 0) / otherData.length;
            weights.eveningEffect = (eveningData.reduce((s, d) => s + d.isBooked, 0) / eveningData.length) - otherAvg;
            weights.afternoonEffect = (afternoonData.reduce((s, d) => s + d.isBooked, 0) / afternoonData.length) - otherAvg;
            weights.morningEffect = (morningData.reduce((s, d) => s + d.isBooked, 0) / morningData.length) - otherAvg;
            
            weights.baseProb = data.reduce((s, d) => s + d.isBooked, 0) / data.length;
            
            return weights;
        }
        
        function calculateLeadTime(dateStr, hour) {
            const now = new Date();
            const targetDate = new Date(dateStr);
            targetDate.setHours(hour, 0, 0, 0);
            const leadTimeHours = (targetDate - now) / (1000 * 60 * 60);
            return Math.max(0, leadTimeHours);
        }
        
        function predictWithModel(dateStr, hour, weights) {
            const date = new Date(dateStr);
            const weekday = date.getDay();
            const periodInfo = getPeriodInfo(dateStr);
            const leadTime = calculateLeadTime(dateStr, hour);
            
            let prob = weights.baseProb;
            
            if (periodInfo.isHoliday) prob += weights.holidayEffect * 0.8;
            if (periodInfo.isExam) prob += weights.examEffect * 1.2;
            if (periodInfo.isPerf) prob += weights.perfEffect * 1.0;
            
            if (hour >= 18 && hour <= 21) prob += weights.eveningEffect;
            else if (hour >= 14 && hour <= 17) prob += weights.afternoonEffect;
            else if (hour >= 9 && hour <= 11) prob += weights.morningEffect;
            
            let timeFactor = 1.0;
            if (leadTime < 6) timeFactor = 0.85;
            else if (leadTime < 24) timeFactor = 0.70;
            else if (leadTime < 72) timeFactor = 0.55;
            else if (leadTime < 168) timeFactor = 0.40;
            else if (leadTime < 336) timeFactor = 0.25;
            else timeFactor = 0.15;
            
            prob = prob * timeFactor;
            
            const noise = (Math.random() - 0.5) * 0.05;
            prob = Math.max(0.05, Math.min(0.95, prob + noise));
            
            return { probability: prob * 100, leadTime: leadTime };
        }
        
        function initializeModel() {
            document.getElementById('dataStatus').innerHTML = 'â³ í•™ìŠµ ë°ì´í„° ìƒì„± ë° ëª¨ë¸ í•™ìŠµ ì¤‘...';
            document.getElementById('dataStatus').className = 'alert alert-info';
            
            setTimeout(() => {
                trainingData = generateTrainingData();
                modelWeights = trainSimulatedModel(trainingData);
                
                document.getElementById('dataStatus').className = 'alert alert-success';
                document.getElementById('dataStatus').innerHTML = `âœ… ML ëª¨ë¸ í•™ìŠµ ì™„ë£Œ! (${trainingData.length}ê°œ ë ˆì½”ë“œ)`;
                
                document.getElementById('dataPreviewSection').classList.remove('hidden');
                renderDataPreview();
                
                document.getElementById('dateWarning').classList.add('hidden');
                document.getElementById('datePickerSection').classList.remove('hidden');
                
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                const minDate2026 = '2026-01-01';
                const minDate = todayStr > minDate2026 ? todayStr : minDate2026;
                const defaultDate = todayStr > '2026-03-15' ? todayStr : '2026-03-15';
                
                document.getElementById('datePicker').value = defaultDate > '2026-12-31' ? '2026-12-31' : defaultDate;
                document.getElementById('datePicker').min = minDate > '2026-12-31' ? '2026-12-31' : minDate;
                document.getElementById('datePicker').max = '2026-12-31';
                
                onDateChange();
            }, 500);
        }
        
        function renderDataPreview() {
            const preview = trainingData.slice(0, 20);
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì›”</th>
                            <th>ì¼</th>
                            <th>ìš”ì¼</th>
                            <th>ì‹œê°„ëŒ€</th>
                            <th>íœ´ì¼</th>
                            <th>ì‹œí—˜ê¸°ê°„</th>
                            <th>ê³µì—°ì‹œì¦Œ</th>
                            <th>ì˜ˆì•½</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const row of preview) {
                html += `
                    <tr>
                        <td>${row.month}</td>
                        <td>${row.day}</td>
                        <td>${WEEKDAY_NAMES_PY[row.weekday]}</td>
                        <td>${row.hour}:00~${row.hour + 1}:00</td>
                        <td>${row.isHoliday ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</td>
                        <td>${row.isExam ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</td>
                        <td>${row.isPerf ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</td>
                        <td>${row.isBooked ? 'ì˜ˆì•½ë¨' : 'ë¯¸ì˜ˆì•½'}</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            document.getElementById('dataPreview').innerHTML = html;
        }
        
        function toggleDataPreview() {
            const preview = document.getElementById('dataPreview');
            const header = document.querySelector('.expandable');
            preview.classList.toggle('hidden');
            header.classList.toggle('expanded');
        }
        
        function onDateChange() {
            const dateInput = document.getElementById('datePicker').value;
            if (!dateInput || !modelWeights) return;
            
            selectedDate = new Date(dateInput);
            selectedTimeSlot = null;
            currentPeriodInfo = getPeriodInfo(dateInput);
            
            const weekday = selectedDate.getDay();
            const weekdayName = WEEKDAY_NAMES[weekday];
            
            let periodBadges = '';
            if (currentPeriodInfo.isHoliday) {
                periodBadges += '<span class="period-badge badge-holiday">ğŸ‰ íœ´ì¼</span>';
            }
            if (currentPeriodInfo.isExam) {
                periodBadges += '<span class="period-badge badge-exam">ğŸ“š ì‹œí—˜ê¸°ê°„</span>';
            }
            if (currentPeriodInfo.isPerf) {
                periodBadges += '<span class="period-badge badge-perf">ğŸ­ ê³µì—°ì‹œì¦Œ</span>';
            }
            if (!currentPeriodInfo.isHoliday && !currentPeriodInfo.isExam && !currentPeriodInfo.isPerf) {
                periodBadges = '<span class="period-badge badge-normal">ğŸ“† í‰ì¼</span>';
            }
            
            const dateInfoHtml = `
                <div class="date-info-row">
                    <span>ì„ íƒ ë‚ ì§œ</span>
                    <strong>${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼</strong>
                </div>
                <div class="date-info-row">
                    <span>ìš”ì¼</span>
                    <strong>${weekdayName}</strong>
                </div>
                <div class="date-info-row">
                    <span>ê¸°ê°„ íŠ¹ì„±</span>
                    <div>${periodBadges}</div>
                </div>
            `;
            
            document.getElementById('dateInfo').innerHTML = dateInfoHtml;
            document.getElementById('dateInfo').classList.remove('hidden');
            
            let alertsHtml = '';
            if (currentPeriodInfo.isExam) {
                alertsHtml += '<div class="alert alert-exam">ğŸ“š ì‹œí—˜ê¸°ê°„ì—ëŠ” ì˜ˆì•½ ìˆ˜ìš”ê°€ ë†’ìŠµë‹ˆë‹¤!</div>';
            }
            if (currentPeriodInfo.isPerf) {
                alertsHtml += '<div class="alert alert-perf">ğŸ­ ê³µì—°ì‹œì¦Œì—ëŠ” ì—°ìŠµì‹¤ ìˆ˜ìš”ê°€ ì¦ê°€í•©ë‹ˆë‹¤.</div>';
            }
            document.getElementById('periodAlerts').innerHTML = alertsHtml;
            
            calculateRisks(dateInput);
        }
        
        function calculateRisks(dateStr) {
            riskData = {};
            
            for (const hour of TIME_SLOTS) {
                const result = predictWithModel(dateStr, hour, modelWeights);
                riskData[hour] = { probability: result.probability, leadTime: result.leadTime };
            }
            
            renderChart();
            renderTimeSlots();
            
            document.getElementById('riskWarning').classList.add('hidden');
            document.getElementById('chartSection').classList.remove('hidden');
            
            updateBookingSection();
        }
        
        function getRiskLevel(probability) {
            if (probability >= 75) {
                return { level: 'ìœ„í—˜', color: '#FF4B4B', emoji: 'ğŸ”´', class: 'slot-danger' };
            } else if (probability >= 50) {
                return { level: 'ì„ë°•', color: '#FFA500', emoji: 'ğŸŸ ', class: 'slot-imminent' };
            } else if (probability >= 25) {
                return { level: 'ì£¼ì˜', color: '#FFD700', emoji: 'ğŸŸ¡', class: 'slot-caution' };
            } else {
                return { level: 'ì—¬ìœ ', color: '#00CC66', emoji: 'ğŸŸ¢', class: 'slot-safe' };
            }
        }
        
        function renderChart() {
            const hours = TIME_SLOTS.map(h => `${h}:00`);
            const probabilities = TIME_SLOTS.map(h => riskData[h].probability);
            const colors = TIME_SLOTS.map(h => getRiskLevel(riskData[h].probability).color);
            
            const trace = {
                x: hours,
                y: probabilities,
                type: 'bar',
                marker: { color: colors },
                text: probabilities.map(p => `${p.toFixed(0)}%`),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>ë§ˆê° í™•ë¥ : %{y:.1f}%<extra></extra>'
            };
            
            const layout = {
                title: {
                    text: 'ì‹œê°„ëŒ€ë³„ ì˜ˆì•½ ë§ˆê° ìœ„í—˜ë„ (ML ì˜ˆì¸¡)',
                    font: { size: 18 }
                },
                xaxis: { title: 'ì‹œê°„ëŒ€' },
                yaxis: { title: 'ë§ˆê° í™•ë¥  (%)', range: [0, 110] },
                height: 400,
                showlegend: false,
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                shapes: [
                    {
                        type: 'line',
                        x0: -0.5, x1: TIME_SLOTS.length - 0.5,
                        y0: 75, y1: 75,
                        line: { color: '#FF4B4B', dash: 'dash', width: 1 }
                    },
                    {
                        type: 'line',
                        x0: -0.5, x1: TIME_SLOTS.length - 0.5,
                        y0: 50, y1: 50,
                        line: { color: '#FFA500', dash: 'dash', width: 1 }
                    },
                    {
                        type: 'line',
                        x0: -0.5, x1: TIME_SLOTS.length - 0.5,
                        y0: 25, y1: 25,
                        line: { color: '#FFD700', dash: 'dash', width: 1 }
                    }
                ]
            };
            
            Plotly.newPlot('chart', [trace], layout, { responsive: true });
        }
        
        function renderTimeSlots() {
            let html = '<p style="color: #666; margin-bottom: 12px;">â° ì´ë¯¸ ì§€ë‚œ ì‹œê°„ëŒ€ëŠ” ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í´ë¦­í•˜ì—¬ ë³µìˆ˜ ì„ íƒ/í•´ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>';
            
            const now = new Date();
            const currentHour = now.getHours();
            const todayStr = now.toISOString().split('T')[0];
            const selectedDateStr = document.getElementById('datePicker').value;
            const isToday = selectedDateStr === todayStr;
            
            for (const hour of TIME_SLOTS) {
                const data = riskData[hour];
                const prob = data.probability;
                const risk = getRiskLevel(prob);
                const isSelected = selectedTimeSlots.includes(hour);
                const selected = isSelected ? 'selected' : '';
                const isPastTime = isToday && hour <= currentHour;
                
                if (isPastTime) {
                    html += `
                        <div class="time-slot slot-disabled" title="ì´ë¯¸ ì§€ë‚œ ì‹œê°„ì…ë‹ˆë‹¤">
                            <div class="time-slot-time">${hour}:00</div>
                            <div class="time-slot-risk">â›” ë¶ˆê°€</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="time-slot ${risk.class} ${selected}" onclick="toggleTimeSlot(${hour})">
                            <div class="time-slot-time">${isSelected ? 'âœ… ' : ''}${hour}:00</div>
                            <div class="time-slot-risk">${risk.emoji} ${risk.level}</div>
                            <div style="font-size: 0.8rem; margin-top: 4px;">${prob.toFixed(0)}%</div>
                        </div>
                    `;
                }
            }
            
            document.getElementById('timeSlots').innerHTML = html;
        }
        
        function toggleTimeSlot(hour) {
            const index = selectedTimeSlots.indexOf(hour);
            if (index > -1) {
                selectedTimeSlots.splice(index, 1);
            } else {
                selectedTimeSlots.push(hour);
                selectedTimeSlots.sort((a, b) => a - b);
            }
            renderTimeSlots();
            updateBookingSection();
        }
        
        function clearSelection() {
            selectedTimeSlots = [];
            renderTimeSlots();
            updateBookingSection();
        }
        
        function formatLeadTime(hours) {
            if (hours < 24) {
                return `${hours.toFixed(1)}ì‹œê°„ ì „`;
            } else if (hours < 168) {
                return `${(hours / 24).toFixed(1)}ì¼ ì „`;
            } else {
                return `${(hours / 168).toFixed(1)}ì£¼ ì „`;
            }
        }
        
        function updateBookingSection() {
            if (selectedTimeSlots.length === 0) {
                document.getElementById('bookingWarning').classList.remove('hidden');
                document.getElementById('bookingSummary').classList.add('hidden');
                return;
            }
            
            document.getElementById('bookingWarning').classList.add('hidden');
            document.getElementById('bookingSummary').classList.remove('hidden');
            
            const totalHours = selectedTimeSlots.length;
            const hourlyRate = 110000;
            const totalPrice = hourlyRate * totalHours;
            
            const timeRanges = selectedTimeSlots.map(h => `${h}:00~${h+1}:00`).join(', ');
            
            const avgProb = selectedTimeSlots.reduce((sum, h) => sum + riskData[h].probability, 0) / totalHours;
            const maxRiskHour = selectedTimeSlots.reduce((max, h) => 
                riskData[h].probability > riskData[max].probability ? h : max, selectedTimeSlots[0]);
            const maxRiskInfo = riskData[maxRiskHour];
            const maxRisk = getRiskLevel(maxRiskInfo.probability);
            
            const firstHour = selectedTimeSlots[0];
            const leadTime = riskData[firstHour].leadTime;
            const weekday = selectedDate.getDay();
            
            let periodStr = [];
            if (currentPeriodInfo.isHoliday) periodStr.push('íœ´ì¼');
            if (currentPeriodInfo.isExam) periodStr.push('ì‹œí—˜ê¸°ê°„');
            if (currentPeriodInfo.isPerf) periodStr.push('ê³µì—°ì‹œì¦Œ');
            const periodText = periodStr.length > 0 ? periodStr.join(', ') : 'í‰ì¼';
            
            let slotDetails = selectedTimeSlots.map(h => {
                const info = riskData[h];
                const risk = getRiskLevel(info.probability);
                return `<div style="font-size: 0.9rem; margin: 2px 0;">${risk.emoji} ${h}:00~${h+1}:00 (${info.probability.toFixed(0)}%)</div>`;
            }).join('');
            
            const bookingHtml = `
                <div class="booking-row">
                    <span>ì˜ˆì•½ ë‚ ì§œ</span>
                    <strong>${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼ (${WEEKDAY_NAMES[weekday]})</strong>
                </div>
                <div class="booking-row">
                    <span>ì˜ˆì•½ ì‹œê°„</span>
                    <strong>${timeRanges} (${totalHours}ì‹œê°„)</strong>
                </div>
                <div class="booking-row">
                    <span>ê¸°ê°„ íŠ¹ì„±</span>
                    <strong>${periodText}</strong>
                </div>
                <div class="booking-row">
                    <span>ì˜ˆì•½ ì‹œì </span>
                    <strong>ğŸ• ${formatLeadTime(leadTime)} (ë¦¬ë“œíƒ€ì„: ${leadTime.toFixed(0)}ì‹œê°„)</strong>
                </div>
                <div class="booking-row">
                    <span>í‰ê·  ë§ˆê° í™•ë¥ </span>
                    <strong style="color: ${maxRisk.color}">${avgProb.toFixed(0)}%</strong>
                </div>
                <div class="booking-row">
                    <span>ì„ íƒëœ ì‹œê°„ëŒ€</span>
                    <div>${slotDetails}</div>
                </div>
                <div class="booking-row">
                    <span>ì˜ˆìƒ ì´ìš©ë£Œ</span>
                    <strong style="color: #7B68EE;">â‚©${totalPrice.toLocaleString()} (${totalHours}ì‹œê°„)</strong>
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="clearSelection()" style="background: #f0f0f0; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">ì„ íƒ ì´ˆê¸°í™”</button>
                </div>
            `;
            
            document.getElementById('bookingDetails').innerHTML = bookingHtml;
            document.getElementById('bookingBtn').textContent = `ğŸ¯ ${totalHours}ì‹œê°„ ì˜ˆì•½í•˜ê¸°`;
        }
        
        function processBooking() {
            if (selectedTimeSlots.length === 0) return;
            
            const totalHours = selectedTimeSlots.length;
            const hourlyRate = 110000;
            const totalPrice = hourlyRate * totalHours;
            const timeRanges = selectedTimeSlots.map(h => `${h}:00~${h+1}:00`).join(', ');
            
            const firstHour = selectedTimeSlots[0];
            const leadTime = riskData[firstHour].leadTime;
            const weekday = selectedDate.getDay();
            
            let periodStr = [];
            if (currentPeriodInfo.isHoliday) periodStr.push('íœ´ì¼');
            if (currentPeriodInfo.isExam) periodStr.push('ì‹œí—˜ê¸°ê°„');
            if (currentPeriodInfo.isPerf) periodStr.push('ê³µì—°ì‹œì¦Œ');
            const periodText = periodStr.length > 0 ? periodStr.join(', ') : 'í‰ì¼';
            
            const modalHtml = `
                <div class="booking-summary" style="text-align: left; margin-top: 20px;">
                    <div class="booking-row">
                        <span>ì˜ˆì•½ ë‚ ì§œ</span>
                        <strong>${selectedDate.getFullYear()}ë…„ ${selectedDate.getMonth() + 1}ì›” ${selectedDate.getDate()}ì¼ (${WEEKDAY_NAMES[weekday]})</strong>
                    </div>
                    <div class="booking-row">
                        <span>ì˜ˆì•½ ì‹œê°„</span>
                        <strong>${timeRanges} (${totalHours}ì‹œê°„)</strong>
                    </div>
                    <div class="booking-row">
                        <span>ì˜ˆì•½ ì‹œì </span>
                        <strong>ğŸ• ${formatLeadTime(leadTime)}</strong>
                    </div>
                    <div class="booking-row">
                        <span>ê¸°ê°„ íŠ¹ì„±</span>
                        <strong>${periodText}</strong>
                    </div>
                    <div class="booking-row">
                        <span>ê²°ì œ ê¸ˆì•¡</span>
                        <strong style="color: #7B68EE; font-size: 1.2rem;">â‚©${totalPrice.toLocaleString()}</strong>
                    </div>
                </div>
            `;
            
            document.getElementById('modalBookingInfo').innerHTML = modalHtml;
            document.getElementById('bookingModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('bookingModal').classList.remove('show');
        }
        
        document.getElementById('bookingModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
